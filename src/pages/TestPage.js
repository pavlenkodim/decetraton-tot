import React, { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import Button from "../components/Button";

function TestPage() {
  const { courseId, lessonId } = useParams();
  const navigate = useNavigate();
  const [test, setTest] = useState(null);
  const [answers, setAnswers] = useState({});

  useEffect(() => {
    // Моковые данные тестов для уроков курса "Основы программирования", "Веб-разработка" и "Основы мобильной разработки"
    const testData = {
      course1: {
        1: {
          questions: [
            {
              id: 1,
              text: "Что такое алгоритм?",
              options: [
                "Набор инструкций для решения задачи",
                "Язык программирования",
                "Компьютерная программа",
                "Математическая формула",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какие шаги включает создание алгоритма?",
              options: [
                "Анализ задачи, проектирование, тестирование",
                "Компиляция, интерпретация, выполнение",
                "Создание функций, создание переменных, вывод данных",
                "Загрузка данных, сортировка, вывод",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Какую роль играет последовательность в алгоритме?",
              options: [
                "Определяет порядок выполнения шагов",
                "Сохраняет данные в памяти",
                "Управляет потоками программы",
                "Предоставляет доступ к базе данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Какие типы алгоритмов существуют?",
              options: [
                "Линейные, разветвляющиеся, циклические",
                "Параллельные, асинхронные, рекурсивные",
                "Локальные, глобальные, динамические",
                "Константные, условные, итерационные",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Что такое блок-схема?",
              options: [
                "Графическое представление алгоритма",
                "Текстовая инструкция программы",
                "Описание переменных и их типов",
                "Функция для запуска алгоритма",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Какова цель тестирования алгоритма?",
              options: [
                "Найти ошибки и убедиться в правильности выполнения",
                "Оптимизировать скорость выполнения",
                "Создать новые функции и методы",
                "Изменить типы данных в программе",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Что такое псевдокод?",
              options: [
                "Описательный язык для представления алгоритма",
                "Программный язык высокого уровня",
                "Машинный код",
                "Графическая схема алгоритма",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Какие преимущества дает использование алгоритмов?",
              options: [
                "Упрощение процесса решения задач",
                "Увеличение времени выполнения программы",
                "Снижение уровня абстракции",
                "Повышение сложности программы",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Что такое детерминированность в алгоритмах?",
              options: [
                "Гарантия получения одинакового результата при одинаковых входных данных",
                "Случайное выполнение шагов алгоритма",
                "Использование различных типов данных",
                "Определение скорости выполнения программы",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Какие критерии качества алгоритма важны?",
              options: [
                "Правильность, эффективность, простота",
                "Красота, сложность, нестабильность",
                "Размер, количество переменных, использование памяти",
                "Скорость, сложность, язык программирования",
              ],
              correctAnswer: 0,
            },
          ],
        },
        2: {
          questions: [
            {
              id: 1,
              text: "Что такое переменная в программировании?",
              options: [
                "Область памяти для хранения данных",
                "Команда для запуска программы",
                "Функция для обработки данных",
                "Оператор сравнения",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какие типы данных используются для переменных?",
              options: [
                "Числа, строки, булевые значения",
                "Файлы, каталоги, процессы",
                "Программы, команды, модули",
                "Части кода, функции, процедуры",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Что означает инициализация переменной?",
              options: [
                "Присвоение начального значения переменной",
                "Удаление переменной",
                "Копирование переменной",
                "Изменение типа данных переменной",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Что такое тип данных?",
              options: [
                "Определяет, какого рода данные могут храниться в переменной",
                "Скорость выполнения программы",
                "Место хранения переменной в памяти",
                "Алгоритм обработки данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Какой тип данных используется для хранения текста?",
              options: [
                "Строка",
                "Целое число",
                "Логическое значение",
                "Массив",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Какой тип данных используется для хранения истинности (true/false)?",
              options: [
                "Булевый",
                "Целое число",
                "Строка",
                "Массив",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Что произойдет, если обратиться к переменной, которой не присвоено значение?",
              options: [
                "Переменная будет иметь значение 'undefined'",
                "Будет присвоено значение 0",
                "Будет ошибка компиляции",
                "Программа завершится с ошибкой",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Что такое локальная переменная?",
              options: [
                "Переменная, объявленная внутри функции и доступная только в этой функции",
                "Переменная, доступная во всей программе",
                "Переменная, доступная в нескольких модулях",
                "Переменная, не имеющая типа данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Что такое глобальная переменная?",
              options: [
                "Переменная, объявленная вне функций и доступная всей программе",
                "Переменная, доступная только внутри функции",
                "Переменная, которая не имеет значения",
                "Переменная, используемая для работы с файлами",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Как можно изменить значение переменной?",
              options: [
                "Присвоить ей новое значение с помощью оператора присваивания",
                "Изменить её тип данных",
                "Создать новую переменную с тем же именем",
                "Удалить переменную и создать заново",
              ],
              correctAnswer: 0,
            },
          ],
        },
      },
      course2: {
        1: {
          questions: [
            {
              id: 1,
              text: "Что такое HTML?",
              options: [
                "Язык гипертекстовой разметки",
                "Язык программирования",
                "Текстовый редактор",
                "База данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какой тег используется для создания заголовка в HTML?",
              options: [
                "<h1>",
                "<title>",
                "<header>",
                "<head>",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Какой тег используется для создания ссылки?",
              options: [
                "<a>",
                "<link>",
                "<href>",
                "<src>",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Какой атрибут используется для указания URL ссылки в теге <a>?",
              options: [
                "href",
                "src",
                "link",
                "url",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Что такое элемент HTML?",
              options: [
                "Составной блок, включающий начальный и конечный теги, а также содержимое между ними",
                "Только начальный тег",
                "Только конечный тег",
                "Строка кода, выполняющая функцию",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Какой тег используется для создания абзаца в HTML?",
              options: [
                "<p>",
                "<br>",
                "<div>",
                "<span>",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Что такое атрибут в HTML?",
              options: [
                "Дополнительная информация о теге",
                "Тип данных переменной",
                "Функция для выполнения операции",
                "Метод обработки данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Какой тег используется для добавления изображения в HTML?",
              options: [
                "<img>",
                "<image>",
                "<pic>",
                "<src>",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Какой атрибут используется для указания пути к изображению в теге <img>?",
              options: [
                "src",
                "href",
                "link",
                "path",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Что делает тег <ul> в HTML?",
              options: [
                "Создает ненумерованный список",
                "Создает нумерованный список",
                "Создает таблицу",
                "Создает абзац",
              ],
              correctAnswer: 0,
            },
          ],
        },
        2: {
          questions: [
            {
              id: 1,
              text: "Что такое CSS?",
              options: [
                "Каскадные таблицы стилей",
                "Язык программирования",
                "Текстовый редактор",
                "База данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какой свойство CSS используется для изменения цвета текста?",
              options: [
                "color",
                "font-size",
                "background-color",
                "text-align",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Какой символ используется для указания идентификатора (ID) в CSS?",
              options: [
                "#",
                ".",
                "*",
                "@",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Какое свойство используется для изменения размера шрифта?",
              options: [
                "font-size",
                "text-size",
                "size",
                "font-weight",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Какой символ используется для указания класса в CSS?",
              options: [
                ".",
                "#",
                "*",
                "@",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Какое свойство используется для выравнивания текста по центру?",
              options: [
                "text-align: center;",
                "align: center;",
                "font-align: center;",
                "center-text: true;",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Что такое селектор в CSS?",
              options: [
                "Элемент, к которому применяются стили",
                "Функция для выполнения операции",
                "Тип данных переменной",
                "Метод обработки данных",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Какое свойство используется для установки фона элемента?",
              options: [
                "background-color",
                "color",
                "font-style",
                "text-decoration",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Какое значение свойства display делает элемент блочным?",
              options: [
                "block",
                "inline",
                "flex",
                "grid",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Как изменить прозрачность элемента в CSS?",
              options: [
                "opacity",
                "transparent",
                "visibility",
                "alpha",
              ],
              correctAnswer: 0,
            },
          ],
        },
        3: {
          questions: [
            {
              id: 1,
              text: "Что такое JavaScript?",
              options: [
                "Язык программирования для веб-разработки",
                "Язык разметки",
                "База данных",
                "Операционная система",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Для чего используется JavaScript в веб-разработке?",
              options: [
                "Для добавления интерактивности на веб-страницы",
                "Для создания структуры веб-страницы",
                "Для хранения данных",
                "Для стилизации веб-страницы",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Как объявить функцию в JavaScript?",
              options: [
                "function myFunction() {}",
                "def myFunction() {}",
                "function: myFunction() {}",
                "create function myFunction() {}",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Что такое условный оператор в JavaScript?",
              options: [
                "Конструкция, которая выполняет код в зависимости от условия",
                "Функция для выполнения повторяющихся действий",
                "Тип данных для хранения значений",
                "Метод для стилизации элементов",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Как создать переменную в JavaScript?",
              options: [
                "let myVar;",
                "var = myVar;",
                "create myVar;",
                "define myVar;",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Как вывести сообщение в консоль в JavaScript?",
              options: [
                "console.log('Hello');",
                "print('Hello');",
                "echo('Hello');",
                "alert('Hello');",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Какой оператор используется для проверки равенства в JavaScript?",
              options: [
                "==",
                "=",
                "===",
                "!==",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Как создать массив в JavaScript?",
              options: [
                "let myArray = [];",
                "let myArray = {};",
                "let myArray = () => {};",
                "create array myArray;",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Что такое цикл for в JavaScript?",
              options: [
                "Конструкция для выполнения блока кода несколько раз",
                "Тип данных для хранения значений",
                "Оператор для выполнения одного действия",
                "Метод для стилизации элемента",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Как добавить элемент в конец массива в JavaScript?",
              options: [
                "myArray.push('value');",
                "myArray.add('value');",
                "myArray.append('value');",
                "myArray.insert('value');",
              ],
              correctAnswer: 0,
            },
          ],
        },
      },
      course3: {
        1: {
          questions: [
            {
              id: 1,
              text: "Что такое мобильная платформа?",
              options: [
                "Операционная система для мобильных устройств",
                "Программное обеспечение для компьютеров",
                "Текстовый редактор для мобильных устройств",
                "Аппаратное обеспечение мобильного устройства",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какие операционные системы являются популярными для мобильной разработки?",
              options: [
                "Android и iOS",
                "Windows и MacOS",
                "Linux и Unix",
                "ChromeOS и Ubuntu",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Что такое мобильное приложение?",
              options: [
                "Программа, созданная для работы на мобильных устройствах",
                "Текстовый файл для мобильных устройств",
                "Сайт, оптимизированный для компьютеров",
                "Операционная система для мобильных устройств",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Какие существуют типы мобильных приложений?",
              options: [
                "Нативные, веб-приложения, гибридные",
                "Системные, графические, текстовые",
                "Облачные, клиентские, серверные",
                "Сетевые, локальные, мобильные",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Что такое нативное мобильное приложение?",
              options: [
                "Приложение, разработанное специально для определенной операционной системы",
                "Приложение, работающее только через браузер",
                "Приложение, не требующее установки",
                "Приложение для всех операционных систем",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Что такое гибридное мобильное приложение?",
              options: [
                "Приложение, сочетающее особенности веб-приложения и нативного приложения",
                "Приложение, предназначенное только для Android",
                "Приложение, работающее на старых устройствах",
                "Только веб-приложение",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Какой язык программирования часто используется для разработки Android-приложений?",
              options: [
                "Java",
                "Swift",
                "Python",
                "Ruby",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Какой язык программирования используется для разработки iOS-приложений?",
              options: [
                "Swift",
                "Java",
                "Kotlin",
                "C++",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Что такое адаптивный дизайн для мобильных приложений?",
              options: [
                "Проектирование интерфейсов, которые корректно отображаются на экранах разного размера",
                "Создание приложений для ПК",
                "Тестирование мобильных приложений",
                "Оптимизация работы мобильных приложений",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Что такое API в контексте мобильной разработки?",
              options: [
                "Интерфейс для взаимодействия приложения с другими сервисами",
                "Язык программирования для мобильных устройств",
                "Приложение для создания дизайна интерфейсов",
                "Операционная система мобильного устройства",
              ],
              correctAnswer: 0,
            },
          ],
        },
        2: {
          questions: [
            {
              id: 1,
              text: "Что такое Android Studio?",
              options: [
                "Интегрированная среда разработки (IDE) для создания приложений на Android",
                "Язык программирования для создания мобильных приложений",
                "Тестовая платформа для мобильных устройств",
                "Операционная система для мобильных телефонов",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какие языки программирования поддерживаются Android Studio для разработки?",
              options: [
                "Java и Kotlin",
                "Python и C++",
                "JavaScript и PHP",
                "HTML и CSS",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Что такое Gradle в Android Studio?",
              options: [
                "Система сборки, используемая для автоматизации процессов создания приложений",
                "Среда выполнения для Android-приложений",
                "Файл ресурсов для определения интерфейса",
                "Скрипт для написания SQL-запросов",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Что такое эмулятор в Android Studio?",
              options: [
                "Программное обеспечение, которое позволяет запускать Android-приложения на компьютере",
                "Средство для создания пользовательских интерфейсов",
                "Среда выполнения Java-кода",
                "Библиотека для работы с графикой",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Что такое XML в Android-разработке?",
              options: [
                "Язык разметки для определения пользовательского интерфейса",
                "Язык программирования для написания бизнес-логики",
                "Формат для сжатия изображений",
                "Интерпретатор Java-кода",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Какую роль играет файл AndroidManifest.xml?",
              options: [
                "Хранит информацию о приложении, его компонентах и разрешениях",
                "Определяет графический интерфейс пользователя",
                "Является файлом для хранения базы данных",
                "Содержит описание локализации приложения",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Что такое Activity в Android?",
              options: [
                "Компонент приложения, представляющий один экран с пользовательским интерфейсом",
                "Функция для работы с базой данных",
                "Класс для обработки мультимедиа",
                "Файл для хранения данных пользователя",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Как запустить эмулятор Android в Android Studio?",
              options: [
                "Использовать Android Virtual Device (AVD) Manager",
                "Написать специальный скрипт на Kotlin",
                "Запустить команду через терминал",
                "Создать проект на C++",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Что такое layout-файл?",
              options: [
                "XML-файл, описывающий структуру пользовательского интерфейса",
                "Файл, хранящий ресурсы для мультимедиа",
                "Конфигурационный файл Gradle",
                "Файл, содержащий логи приложения",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Какой метод используется для запуска новой Activity?",
              options: [
                "startActivity()",
                "launchActivity()",
                "openActivity()",
                "beginActivity()",
              ],
              correctAnswer: 0,
            },
          ],
        },
        3: {
          questions: [
            {
              id: 1,
              text: "Что такое View в Android?",
              options: [
                "Основной строительный блок пользовательского интерфейса",
                "Класс для работы с базой данных",
                "Функция для выполнения сетевых запросов",
                "Метод для создания файлов ресурсов",
              ],
              correctAnswer: 0,
            },
            {
              id: 2,
              text: "Какой класс используется для создания текстовых полей в Android?",
              options: [
                "TextView",
                "EditBox",
                "TextInput",
                "TextField",
              ],
              correctAnswer: 0,
            },
            {
              id: 3,
              text: "Какой метод используется для обработки нажатий на кнопку?",
              options: [
                "setOnClickListener()",
                "handleClick()",
                "onButtonPressed()",
                "clickHandler()",
              ],
              correctAnswer: 0,
            },
            {
              id: 4,
              text: "Что такое RecyclerView?",
              options: [
                "Элемент пользовательского интерфейса для отображения больших наборов данных",
                "Класс для работы с потоками данных",
                "Компонент для воспроизведения видео",
                "Библиотека для работы с изображениями",
              ],
              correctAnswer: 0,
            },
            {
              id: 5,
              text: "Какой класс используется для отображения списка элементов в Android?",
              options: [
                "RecyclerView",
                "ListAdapter",
                "ArrayAdapter",
                "GridView",
              ],
              correctAnswer: 0,
            },
            {
              id: 6,
              text: "Что такое Intent?",
              options: [
                "Механизм для запуска компонентов приложения, таких как Activity или Service",
                "Класс для работы с базами данных",
                "Метод для создания диалоговых окон",
                "Объект для выполнения сетевых запросов",
              ],
              correctAnswer: 0,
            },
            {
              id: 7,
              text: "Какое назначение у ConstraintLayout?",
              options: [
                "Компоновка для создания гибких и сложных пользовательских интерфейсов",
                "Интерфейс для работы с базами данных",
                "Формат для хранения текстовых данных",
                "Метод для выполнения сетевых запросов",
              ],
              correctAnswer: 0,
            },
            {
              id: 8,
              text: "Что такое Toast в Android?",
              options: [
                "Кратковременное уведомление для отображения сообщения пользователю",
                "Библиотека для работы с мультимедиа",
                "Метод для стилизации текстовых полей",
                "Элемент интерфейса для воспроизведения аудио",
              ],
              correctAnswer: 0,
            },
            {
              id: 9,
              text: "Как добавить изображение в Android-приложение?",
              options: [
                "Использовать ImageView и задать ему ресурс изображения",
                "Добавить изображение через TextView",
                "Использовать ImageField для хранения изображения",
                "Создать ссылку через LinkView",
              ],
              correctAnswer: 0,
            },
            {
              id: 10,
              text: "Какой метод используется для сохранения состояния Activity при её перезапуске?",
              options: [
                "onSaveInstanceState()",
                "onCreateInstance()",
                "saveState()",
                "onRestoreState()",
              ],
              correctAnswer: 0,
            },
          ],
        },
      },      
    };

    setTest(testData[courseId] && testData[courseId][lessonId] ? testData[courseId][lessonId] : null);
  }, [courseId, lessonId]);

  const handleAnswerSelect = (questionId, answerIndex) => {
    setAnswers((prev) => ({ ...prev, [questionId]: answerIndex }));
  };

  const handleSubmit = () => {
    // Проверка правильности ответов и подсчет результатов
    let correctAnswers = 0;
    test.questions.forEach((question) => {
      if (answers[question.id] === question.correctAnswer) {
        correctAnswers++;
      }
    });

    const results = {
      score: (correctAnswers / test.questions.length) * 100,
      totalQuestions: test.questions.length,
      correctAnswers,
      date: new Date().toISOString(),
      earnedPoints: correctAnswers * 10, // Допустим, за каждый правильный ответ 10 очков
    };

    // Перенаправляем на страницу результатов
    navigate(`/course/${courseId}/lesson/${lessonId}/test/result`, {
      state: { results, courseId, lessonId },
    });
  };

  if (!test) {
    return <div>Загрузка...</div>;
  }

  return (
    <div className="test-page">
      <h1>Тест по уроку</h1>
      {test.questions.map((question, qIndex) => (
        <div key={question.id} className="question-block">
          <h2>Вопрос {qIndex + 1}</h2>
          <p>{question.text}</p>
          <div className="options">
            {question.options.map((option, oIndex) => (
              <label key={oIndex} className="option">
                <input
                  type="radio"
                  name={`question-${question.id}`}
                  checked={answers[question.id] === oIndex}
                  onChange={() => handleAnswerSelect(question.id, oIndex)}
                />
                {option}
              </label>
            ))}
          </div>
        </div>
      ))}
      <Button onClick={handleSubmit}>Завершить тест</Button>
    </div>
  );
}

export default TestPage;
